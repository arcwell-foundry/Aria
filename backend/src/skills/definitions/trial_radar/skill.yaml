name: trial-radar
description: Tracks and analyzes clinical trials from ClinicalTrials.gov to surface competitive intelligence on phase distribution, enrollment, and endpoints
agent_assignment:
  - analyst
  - scout
  - strategist
trust_level: core
estimated_seconds: 40

system_prompt: |
  You are ARIA's Trial Radar — a specialized clinical trial intelligence engine for
  life sciences commercial teams. You analyze ClinicalTrials.gov data to track active
  trials, map competitive landscapes, and surface enrollment and endpoint intelligence.

  Data Source: ClinicalTrials.gov API v2
  - Base URL: https://clinicaltrials.gov/api/v2/
  - Study search: GET studies?query.cond={condition}&query.spons={sponsor}&filter.overallStatus=RECRUITING,ACTIVE_NOT_RECRUITING,ENROLLING_BY_INVITATION&pageSize=100&format=json
  - Study detail: GET studies/{nctId}?format=json
  - Field values: GET studies?query.cond={condition}&fields=NCTId,BriefTitle,Phase,OverallStatus,EnrollmentCount,StartDate,PrimaryCompletionDate,Condition,InterventionName,LeadSponsorName&pageSize=100&format=json
  - No authentication required (public API)
  - Rate limit: Respect 429 responses, implement exponential backoff

  Prompt Chain Architecture:
  1. TRIAL DISCOVERY: Search ClinicalTrials.gov by therapeutic area, condition, company,
     or intervention. Filter by status (recruiting, active, completed) and phase.
  2. PHASE DISTRIBUTION: Aggregate trials by phase (Early Phase 1, Phase 1, Phase 1/2,
     Phase 2, Phase 2/3, Phase 3, Phase 4) to show pipeline maturity distribution.
  3. ENROLLMENT ANALYSIS: Track enrollment targets vs actual enrollment, identify
     trials that are behind schedule, and calculate enrollment velocity.
  4. ENDPOINT EXTRACTION: Parse primary and secondary endpoints, categorize by type
     (efficacy, safety, biomarker, PRO/QoL), identify novel endpoint designs.
  5. COMPETITION MAPPING: Identify competing trials in the same indication, compare
     sponsor strategies, highlight differentiation in trial design.
  6. SYNTHESIS: Produce structured intelligence with competitive implications and
     timeline projections.

  Guidelines:
  - Output must be valid JSON matching the output schema exactly.
  - All enrollment numbers must be exact integers from ClinicalTrials.gov.
  - Dates should be ISO 8601 format.
  - Phase labels must use ClinicalTrials.gov conventions: "Early Phase 1", "Phase 1",
    "Phase 1/Phase 2", "Phase 2", "Phase 2/Phase 3", "Phase 3", "Phase 4", "Not Applicable".
  - Status labels: "Recruiting", "Active, not recruiting", "Enrolling by invitation",
    "Completed", "Terminated", "Suspended", "Withdrawn".
  - When mapping competition, group by mechanism of action or drug class where identifiable.
  - Calculate trial density (trials per indication) to identify crowded vs. open spaces.
  - Colors must use ARIA's palette:
    primary: "#6366F1", success: "#10B981", warning: "#F59E0B",
    danger: "#EF4444", info: "#3B82F6", muted: "#6B7280",
    accent1: "#8B5CF6", accent2: "#EC4899", accent3: "#14B8A6".
  - Include confidence_level based on data completeness:
    high = >20 trials with complete metadata,
    moderate = 10–20 trials or partial metadata,
    low = <10 trials or significant metadata gaps.
  - When trial data is unavailable, return empty data arrays with a note
    in metadata.summary explaining the gap.

output_schema:
  type: object
  required:
    - chart_type
    - data
    - config
    - metadata
    - trial_context
  properties:
    chart_type:
      type: string
      enum:
        - bar
        - funnel
        - line
        - treemap
        - radar
      description: Recharts component type to render
    data:
      type: array
      items:
        type: object
      description: Array of data points for the chart
    config:
      type: object
      required:
        - title
        - xKey
        - yKeys
      properties:
        title:
          type: string
          description: Chart title displayed above the visualization
        subtitle:
          type: string
          description: Therapeutic area, sponsor, or indication context
        xKey:
          type: string
          description: Data key for the x-axis or category axis
        yKeys:
          type: array
          items:
            type: object
            required:
              - key
              - label
              - color
            properties:
              key:
                type: string
                description: Data key for this series
              label:
                type: string
                description: Human-readable legend label
              color:
                type: string
                description: Hex color for this series
              stackId:
                type: string
                description: Optional stack group identifier
          description: Data series to render
        layout:
          type: object
          properties:
            width:
              type: integer
              description: Suggested width in pixels
            height:
              type: integer
              description: Suggested height in pixels
            margin:
              type: object
              properties:
                top:
                  type: integer
                right:
                  type: integer
                bottom:
                  type: integer
                left:
                  type: integer
    trial_context:
      type: object
      properties:
        search_scope:
          type: object
          properties:
            therapeutic_area:
              type: string
              description: Broad therapeutic area searched
            condition:
              type: string
              description: Specific condition or indication
            sponsor:
              type: string
              description: Sponsor company filter (if applied)
            intervention:
              type: string
              description: Drug or intervention filter (if applied)
        total_trials_found:
          type: integer
          description: Total matching trials from ClinicalTrials.gov
        phase_distribution:
          type: array
          items:
            type: object
            properties:
              phase:
                type: string
                description: Clinical trial phase
              count:
                type: integer
                description: Number of trials in this phase
              percentage:
                type: number
                description: Percentage of total trials
          description: Trials aggregated by phase
        enrollment_summary:
          type: object
          properties:
            total_target_enrollment:
              type: integer
              description: Sum of enrollment targets across active trials
            actively_recruiting_count:
              type: integer
              description: Trials currently recruiting
            median_enrollment_target:
              type: integer
              description: Median enrollment target per trial
        key_trials:
          type: array
          items:
            type: object
            properties:
              nct_id:
                type: string
                description: ClinicalTrials.gov NCT identifier
              title:
                type: string
                description: Brief title of the trial
              sponsor:
                type: string
                description: Lead sponsor name
              phase:
                type: string
                description: Trial phase
              status:
                type: string
                description: Overall recruitment status
              enrollment_target:
                type: integer
                description: Target enrollment count
              start_date:
                type: string
                description: Study start date (ISO 8601)
              primary_completion_date:
                type: string
                description: Primary completion date (ISO 8601)
              intervention:
                type: string
                description: Drug or intervention name
              primary_endpoint:
                type: string
                description: Primary outcome measure
              endpoint_type:
                type: string
                enum:
                  - efficacy
                  - safety
                  - biomarker
                  - patient_reported_outcome
                  - composite
                description: Classification of primary endpoint
          description: Notable trials with full detail
        competitive_clusters:
          type: array
          items:
            type: object
            properties:
              cluster_name:
                type: string
                description: Mechanism of action or drug class grouping
              trial_count:
                type: integer
                description: Number of competing trials
              sponsors:
                type: array
                items:
                  type: string
                description: Companies with trials in this cluster
              phase_range:
                type: string
                description: "Range of phases (e.g., 'Phase 1 – Phase 3')"
          description: Trials grouped by competitive mechanism or class
    metadata:
      type: object
      properties:
        template:
          type: string
          description: Template used to generate this analysis
        generated_at:
          type: string
          description: ISO 8601 timestamp
        data_sources:
          type: array
          items:
            type: string
          description: APIs and databases queried
        record_count:
          type: integer
          description: Number of trials processed
        confidence_level:
          type: string
          enum:
            - high
            - moderate
            - low
          description: Confidence based on data completeness
        summary:
          type: string
          description: One-line natural language summary of the trial landscape

input_requirements:
  - template_name
  - therapeutic_area

templates:
  trial_landscape:
    description: "Comprehensive clinical trial landscape for {therapeutic_area} — phase distribution, sponsor map, active trial count, and competitive density analysis"
  enrollment_tracker:
    description: "Enrollment status and velocity tracking for active trials in {therapeutic_area} — identify behind-schedule trials and recruitment bottlenecks"
  competitive_trial_comparison:
    description: "Head-to-head comparison of competing trials in {therapeutic_area} — endpoint design differences, enrollment strategies, and timeline projections by sponsor"
